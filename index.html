<!DOCTYPE HTML>


<html>

	<head>
	
	<link rel="stylesheet" type="text/css" href="main.css">

	<title>CSCI 241 Final (WIP)</title>

	<script> 
		
		
		const Classes = [
			"Choose a class",
			"Calc 1",
			"Chem 1",
			"Intro to CS",
			
		]
		
		const Depts = [
			"Choose a department",
			"Math",
			"Science",
			"CSCI",
		];

		const Enrolled = [
			0,
			10,
			5,
			3,
			11,
			0,
			1984,
			6,
			32,
		];

		const Capacity = [
			0,
			16,
			16,
			16,
			51,
			1,
			2023,
			9,
			32
		];
			
		function confirmClass(){
			
			alert("This doesn't work yet. Have a picture of my spirit animal instead.");
			document.body.insertAdjacentHTML("beforeend","<img src = \"https://i.redd.it/lsyzebnjr7k61.jpg\" alt = \"Dog With Cans On Head\" style=\"width:calc(100%/3);\">");

		}

		function updateChoice(colText, selectBox){
			
			colText.innerHTML = "<h2>".concat(selectBox.target.value, ": ", "</h2>");
		}

		function loadPage(){

			if(location.href == "https://www.cs.oberlin.edu/~jarme/index.html"){
				location.href = "http://www.cs.oberlin.edu/~jarme/index.html";
			}

			var classCount = 6;
			
			for(var j = 1; j <= classCount; j++){

				var r = document.createElement("div")
				r.classList.add("row");

				var c = document.createElement("div");
				c.classList.add("column");
				c.classList.add("centerText");

				for(var i = 0; i < 3; i++){

					
					var innerCol = document.createElement("div");
					innerCol.classList.add("innerColumn");
					
					if(i == 0){
						
						//innerCol.classList.add("preferenceText");
						innerCol.innerHTML = "<h2 class = \"preferenceText\">Preference #".concat(j.toString(),"</h2>");
						innerCol.insertAdjacentHTML("beforeend","<p class = \"preferenceText\">(Final implementation may include schedule here)</p>");

					}
					else if(i == 1){
						innerCol.innerHTML = "<h2>Class ".concat(j.toString(), "</h2>");
						innerCol.insertAdjacentHTML("beforeend", "<h4>0/0 students enrolled</h4>");

						var selectDiv = document.createElement("div");
						//selectDiv.classList.add("centerText");
						var o = document.createElement("select");
						o.classList.add("classSelect");
						selectDiv.appendChild(o);
						
						
						for(var v = 0; v < Classes.length; v++){
							
							var choice = document.createElement("option");
							if(v == 0)
								choice.value = -1;
							else
								choice.value = v;
							choice.name = v;
							choice.innerHTML = Classes[v];
	
							o.appendChild(choice);
						}

						o.addEventListener("mousedown", function(e){
							if(e.target.options[e.target.selectedIndex].disabled){
								document.querySelectorAll("option").forEach(opt => {
									if(opt.value == this.value){
										opt.disabled = false;
									}
								});
							}
						});

						o.addEventListener("change", function(e){
						

							var inCol = this.parentElement.parentElement;
							var ind = e.target.value;
							var cName = inCol.querySelector("h2");
							cName.innerHTML = e.target.options[e.target.selectedIndex].text;
							
							var cTot = inCol.querySelector("h4");
							if(ind == -1){
								cTot.innerHTML = "No class selected";
							}
							else{
								cTot.innerHTML = "".concat(Enrolled[ind].toString(),"/",Capacity[ind].toString(), " students enrolled");
							}
							// Disables all classes w/ name, except it's kinda broken atm.
							/*if(ind != 0){

								document.querySelectorAll("option").forEach(opt => {
									
									if(opt.value == ind){
										opt.disabled = true;
									}
								});
							}*/

						
						});
						innerCol.appendChild(selectDiv);
					}
					else{

						innerCol.classList.add("searchCol");
						
						var searchDiv = document.createElement("div");
						searchDiv.classList.add("searchCol");

						innerCol.innerHTML = "<p>Search by class type</p>"
						
						var o = document.createElement("select");
						o.classList.add("classSelect");
						o.style.width = "90%";

						for(var v = 0; v < Depts.length; v++){
							
							var choice = document.createElement("option");
							choice.value = v;
							choice.name = v;
							choice.innerHTML = Depts[v];
	
							o.appendChild(choice);
						}

						o.addEventListener("change", function(e){
										
							var inRow = this.parentElement.parentElement.parentElement;
							var ind = e.target.value;
								
							
							var major_courses;
							
                                                        fetch("http://clyde.cs.oberlin.edu:5000/choose", {
                                                                method: "POST",
                                                                body: JSON.stringify({group : Depts[ind]}),
                                                                headers: { "Content-type": "application/json" }
                                                        })
                                                        .then(response => response.json())
							.then((data)=>{	
								major_courses = data["data"]["result"];
								
								document.querySelectorAll("select").forEach(sel => {
									
									if(sel.parentElement.parentElement.parentElement == inRow && sel != e.target){
										
										sel.innerHTML = "<option value = \"-1\">Choose a class</option>";

										for(var i = 0; i < major_courses.length; i++){
											
											var opt = document.createElement("option");
											opt.value = major_courses[i]["crn"];
											opt.innerHTML = major_courses[i]["class"];
											
											sel.appendChild(opt);
										}
										
									}
									
								});

							})
                                                        //.then(data => console.log(data))
							.catch(error => console.error("Uh oh, error moment"));
							
						});

						var btn = document.createElement("button");
						btn.innerHTML = "Search";
						btn.style.width = "50%";

						searchDiv.appendChild(o);
						searchDiv.appendChild(btn);
						innerCol.appendChild(searchDiv);
						innerCol.insertAdjacentHTML("beforeend","<p>(Not implemented)</p>");
					}
					c.appendChild(innerCol);
					
				}
				r.appendChild(c);
				document.body.appendChild(r);
			}

			var buttonDiv = document.createElement("div");
			buttonDiv.classList.add("confirmButton");

			var button = document.createElement("button");
			button.onclick = function(){confirmClass()};
			button.innerHTML = "<h2>Click to confirm classes</h2>";

			buttonDiv.appendChild(button);
			document.body.appendChild(buttonDiv);

			var footer = document.createElement("div");
			footer.classList.add("footer");
			footer.innerHTML = "<p>Made by Autumn Arme, Anthony Bouzek, Aurora Hegarty, and Marta Laska</p>";
			document.body.appendChild(footer);

		}
	</script>
	

	</head>

	<body onload = "loadPage()">
		
		<div class = "header">
			<div class = "headerRow">
				<div class = "hColumn">
					<h1 class = "headerText">Class Registration</h1>
					<p class = "headerText">At least, an early demo...</p>
				</div>
				<div class = "hColumn">
					<a class = "headerLinks" href = "https://en.wikipedia.org/wiki/Maize">Go to another page</h1>
				</div>
			</div>
		</div>

		<p style = "height:15px"></p>


	</body>

</html>
